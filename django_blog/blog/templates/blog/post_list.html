{% load static %}
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Posts</title>
    <link rel="stylesheet" href="{% static 'blog/style.css' %}">
  </head>
  <body>
    <h1>All Posts{% if tag %} â€” tag: {{ tag }}{% endif %}</h1>
    <form method="get" action="{% url 'blog:search' %}">
      <input type="text" name="q" placeholder="Search posts..." value="{{ request.GET.q|default_if_none:'' }}">
      <button type="submit">Search</button>
    </form>
    {% if user.is_authenticated %}
      <p><a href="{% url 'blog:post_create' %}">Create new post</a></p>
    {% endif %}
    <ul>
      {% for post in posts %}
        <li>
          <a href="{% url 'blog:post_detail' post.pk %}">{{ post.title }}</a>
          <p>{{ post.content|truncatechars:120 }}</p>
          <small>By {{ post.author.username }} on {{ post.published_date }}</small>
          {% if post.tags.all %}
            <p>Tags:
              {% for t in post.tags.all %}
                <a href="{% url 'blog:posts_by_tag' t.name %}">{{ t.name }}</a>{% if not forloop.last %}, {% endif %}
              {% endfor %}
            </p>
          {% endif %}
        </li>
      {% empty %}
        <li>No posts yet.</li>
      {% endfor %}
    </ul>
    <p><a href="{% url 'blog:index' %}">Home</a></p>
  </body>
</html>
